2020-10-03 16:02:48.692031: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudart64_100.dll
============================= test session starts =============================
platform win32 -- Python 3.6.12, pytest-6.0.2, py-1.9.0, pluggy-0.13.1
rootdir: C:\Users\mutation\Desktop\testcase\tests\keras
plugins: flaky-3.7.0
collected 12 items

optimizers_test.py .....F..F...                                          [100%]

================================== FAILURES ===================================
__________________________________ test_adam __________________________________

    def test_adam():
>       _test_optimizer(optimizers.Adam())

optimizers_test.py:120: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

optimizer = <keras.optimizers.Adam object at 0x0000028FADAC2208>, target = 0.75

    def _test_optimizer(optimizer, target=0.75):
        x_train, y_train = get_test_data()
    
        model = Sequential()
        model.add(Dense(10, input_shape=(x_train.shape[1],)))
        model.add(Activation('relu'))
        model.add(Dense(y_train.shape[1]))
        model.add(Activation('softmax'))
        model.compile(loss='categorical_crossentropy',
                      optimizer=optimizer,
                      metrics=['accuracy'])
    
        history = model.fit(x_train, y_train, epochs=3, batch_size=16, verbose=0)
>       assert history.history['accuracy'][-1] >= target
E       assert 0.609 >= 0.75

optimizers_test.py:42: AssertionError
---------------------------- Captured stderr call -----------------------------
2020-10-03 16:03:15.086959: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1618] Found device 0 with properties: 
name: GeForce RTX 2080 Ti major: 7 minor: 5 memoryClockRate(GHz): 1.65
pciBusID: 0000:73:00.0
2020-10-03 16:03:15.087573: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudart64_100.dll
2020-10-03 16:03:15.087916: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cublas64_100.dll
2020-10-03 16:03:15.088255: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cufft64_100.dll
2020-10-03 16:03:15.088590: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library curand64_100.dll
2020-10-03 16:03:15.088928: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusolver64_100.dll
2020-10-03 16:03:15.089267: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusparse64_100.dll
2020-10-03 16:03:15.089614: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudnn64_7.dll
2020-10-03 16:03:15.090212: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1746] Adding visible gpu devices: 0
2020-10-03 16:03:15.090531: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1159] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-10-03 16:03:15.090904: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1165]      0 
2020-10-03 16:03:15.091179: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1178] 0:   N 
2020-10-03 16:03:15.091796: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1304] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 8686 MB memory) -> physical GPU (device: 0, name: GeForce RTX 2080 Ti, pci bus id: 0000:73:00.0, compute capability: 7.5)
______________________________ test_adam_amsgrad ______________________________

    def test_adam_amsgrad():
>       _test_optimizer(optimizers.Adam(amsgrad=True))

optimizers_test.py:134: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

optimizer = <keras.optimizers.Adam object at 0x0000028FB9A169E8>, target = 0.75

    def _test_optimizer(optimizer, target=0.75):
        x_train, y_train = get_test_data()
    
        model = Sequential()
        model.add(Dense(10, input_shape=(x_train.shape[1],)))
        model.add(Activation('relu'))
        model.add(Dense(y_train.shape[1]))
        model.add(Activation('softmax'))
        model.compile(loss='categorical_crossentropy',
                      optimizer=optimizer,
                      metrics=['accuracy'])
    
        history = model.fit(x_train, y_train, epochs=3, batch_size=16, verbose=0)
>       assert history.history['accuracy'][-1] >= target
E       assert 0.609 >= 0.75

optimizers_test.py:42: AssertionError
---------------------------- Captured stderr call -----------------------------
2020-10-03 16:03:27.739399: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1618] Found device 0 with properties: 
name: GeForce RTX 2080 Ti major: 7 minor: 5 memoryClockRate(GHz): 1.65
pciBusID: 0000:73:00.0
2020-10-03 16:03:27.740005: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudart64_100.dll
2020-10-03 16:03:27.740347: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cublas64_100.dll
2020-10-03 16:03:27.740689: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cufft64_100.dll
2020-10-03 16:03:27.741024: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library curand64_100.dll
2020-10-03 16:03:27.741361: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusolver64_100.dll
2020-10-03 16:03:27.741701: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cusparse64_100.dll
2020-10-03 16:03:27.742045: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library cudnn64_7.dll
2020-10-03 16:03:27.742660: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1746] Adding visible gpu devices: 0
2020-10-03 16:03:27.742975: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1159] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-10-03 16:03:27.743326: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1165]      0 
2020-10-03 16:03:27.743542: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1178] 0:   N 
2020-10-03 16:03:27.744059: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1304] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 8686 MB memory) -> physical GPU (device: 0, name: GeForce RTX 2080 Ti, pci bus id: 0000:73:00.0, compute capability: 7.5)
=========================== short test summary info ===========================
FAILED optimizers_test.py::test_adam - assert 0.609 >= 0.75
FAILED optimizers_test.py::test_adam_amsgrad - assert 0.609 >= 0.75
======================== 2 failed, 10 passed in 42.71s ========================
